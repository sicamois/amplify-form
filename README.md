# AmplifyForm

[![npm](https://img.shields.io/npm/v/amplify-form.svg?style=flat-square)](https://www.npmjs.com/package/amplify-form)
[![npm](https://img.shields.io/npm/dt/amplify-form.svg?style=flat-square)](https://www.npmjs.com/package/amplify-form)
[![GitHub last commit](https://img.shields.io/github/last-commit/sicamois/amplify-form.svg?style=flat-square)](https://github.com/sicamois/amplify-form)

**Automatically create Form for your GaphQL API in [AWS Amplify](https://github.com/aws-amplify/amplify-js)**

This React component automatically reads the GraphQL schema of your Amplify API and creates a form for creating new items in your database.

**Functionalities:**

- Create a form for any of your [AWS Amplify GraphQL API](https://docs.amplify.aws/lib/graphqlapi/getting-started/q/platform/js/)
- Generate `values` that can be directly passed to grapql
- Customize Form name ([here](#Add-a-label-to-the-form))
- Create automatically `<select>` for your enums
- Add `<textarea>` for long text ([here](#Add-a-textarea))
- Typescript friendly

<!-- - Add files or images, they are automaticcaly uploaded to your [AWS Amplify Storage](https://docs.amplify.aws/lib/storage/getting-started/q/platform/js/)
- Add relationship between items
- Display custom field labels
- Customize form apperance
- Customize field apperance -->

**Note:**

- **This plugin requires [AWS Amplify](https://github.com/aws-amplify/amplify-js) with a GraphQL API configured**

## Installation

```console
npm install amplify-form
```

or

```console
yarn add amplify-form
```

## Usage

Import the component into your file. Pass the JSON representation of the GraphQL API that Amplify has generated for you and the name of the entity you want to edit.

- Example page : `create-todo-page.ts`:

```js
// Import AmplifyForm
import AmplifyForm from 'amplify-form';

// Path to the JSON representation of the GraphQL Schema
import schema from '../graphql/schema.json';

// Import function to process the Form values (see below for example code)
import addTodo from '../utilities/add-todo';

export default Home = () => {
  return (
    <div>
      <h1>Create a new To do</h1>
      <AmplifyForm
        entity='Todo'
        graphQLJSONSchema={schema}
        onSubmit={addTodo}
      />
    </div>
  );
};
```

### Required props

- `entity`: The name of the entity you want to create a new record of.  
  In this example, the _entity_ is named _Todo_. Thus, the prop you need to pass is `entity='Todo'`.

- `graphQLJSONSchema`: The JSON representation of the GraphQL schema. It's a file generated by Amplify when you execute the `Amplify push` command.  
  By default located in the `graphql` folder (itself located on the project root or in the `src` folder). Look for the `schema.json` file if you have any trouble.

- `onSubmit: async (values: FormValues) => void`: A callback function to retieves the form values. This object can directly be passed to Amplify `API.graphql()` function to add a new record.  
  The function can be asynchronous.

  Example function : `utilities/add-todo.ts`

  ```js
  // Import Amplify
  import Amplify, { API } from 'aws-amplify';
  import awsExports from '../aws-exports';
  import { createTodo } from '../graphql/mutations';
  import { CreateTodoMutation, ListTodosQuery, Todo } from '../API';
  import { GRAPHQL_AUTH_MODE } from '@aws-amplify/api';

  // Import type for Typescript
  import { FormValues } from 'amplify-form'

  export default addTodo: async (values: FormValues) => {
    Amplify.configure({...awsExports});
    try {
      const request = (await API.graphql({
        authMode: GRAPHQL_AUTH_MODE.API_KEY,
        query: createTodo,
        variables: {
          input: values,
        },
      })) as { data: CreateTodoMutation; errors: any[] };
      router.push(`/todo/${request.data.createTodo.id}`);
    } catch (response) {
      if (response.message) {
        const error = response as Error
        throw error
      }
      const { errors } = response
      console.error(...errors);
      throw new Error(errors[0].message);
    }
  }

  ```

## Add a `label` to the form

By default, the form is named after the entity name (the string passed to `entity` prop).  
You can set a custom name by stting the `label`prop.

**Example:**

```js
// Import AmplifyForm
import AmplifyForm from 'amplify-form';

// Path to the JSON representation of the GraphQL Schema
import schema from '../graphql/schema.json';

// Import function to process the Form values
import addTodo from '../utilities/add-todo';

export default Home = () => {
  return (
    <div>
      <h1>Create a new To do</h1>
      <AmplifyForm
        entity='Todo'
        graphQLJSONSchema={schema}
        onSubmit={addTodo}
        label='To do'
      />
    </div>
  );
};
```

## Add a `<textarea>`

By default, strings in GraphQL model are transformed into `<input type='text'>`. This is generally ok, but some strings are meant "long" text, like `description`, `content`, `text`, etc.

AmplifyForm has a simple solution for that :

- `textAreas` : A prop where you pass an array containing all the string fields that need to be displayed as `<textarea>`.

**Example:**

Let's say your GraphQL model `schema.grapql` is a simple Todo list :

```graphql
type Todo
@model {
  id: ID!
  name: String!
  description: String
}
```

If you want `description` to be a `<textarea>` you simple pass its name to the `textAreas` prop like so :

```js
// Import AmplifyForm
import AmplifyForm from 'amplify-form';

// Path to the JSON representation of the GraphQL Schema
import schema from '../graphql/schema.json';

// Import function to process the Form values
import addTodo from '../utilities/add-todo';

export default Home = () => {
  return (
    <div>
      <h1>Create a new To do</h1>
      <AmplifyForm
        entity='Todo'
        graphQLJSONSchema={schema}
        onSubmit={addTodo}
        textAreas={['description']}
      />
    </div>
  );
};
```

**Notes:**

- If you have multiples fields to display as `<textarea>`, you pass them all in a single array.  
  e.g. `textAreas=['description', 'annotations', 'seo_summary']`

- Names are compatible with dotted notation.  
  e.g. `textAreas=['details.description']`

### Advanced usage

For finer control over the `<textarea>`, you can pass `HTMLTextAreaElement` props to `textAreas`.  

For this, you should pass an object to `textAreas` (not an array, which is reserved for the simpler form). The fields to display as `<textarea>` are the keys, and the value for each key is an object containing the `HTMLTextAreaElement` props you want to set.

⚠️ some `HTMLTextAreaElement` props might not work has they may be overwritten somewhere else in the code... Use at your own risks !

**Example:**

```js
// Import AmplifyForm
import AmplifyForm from 'amplify-form';

// Path to the JSON representation of the GraphQL Schema
import schema from '../graphql/schema.json';

// Import function to process the Form values (see below for example code)
import addTodo from '../utilities/add-todo';

export default Home = () => {
  const textAreasConfig = {
    'description': {
      readOnly: true,
      col: 4
    }
  }
  return (
    <div>
      <h1>Create a new To do</h1>
      <AmplifyForm
        entity='Todo'
        graphQLJSONSchema={schema}
        onSubmit={addTodo}
        textAreas={textAreasConfig}
      />
    </div>
  );
};
```

<!-- ## Add images or files

### File field declaration

### Amplify storage props -->

<!-- ## Relationship -->

<!-- ## Field labels -->

<!-- ## Theming -->

<!-- ## Field customisation -->

---

## Contributing

- ⇄ Pull requests and ★ Stars are always welcome.
- For bugs and feature requests, please create an issue.
- Pull requests must be accompanied by passing automated tests (`$ npm test`).

## Acknowledgement

This library relies heavily on the tremendous work of others :

- [React](https://fr.reactjs.org) by [Meta](https://github.com/facebook)
- [TailwindCSS](https://tailwindcss.com) by [Tailwind Labs](https://github.com/tailwindlabs)
- [Formik](https://formik.org) by [Jared Palmer](https://github.com/jaredpalmer)
- [Yup](https://github.com/jquense/yup) by [Jason Quense](https://github.com/jquense)
- [React-Select](https://react-select.com/home) by [Jed Watson](https://github.com/JedWatson)
- [React Dropzone](https://react-dropzone.js.org) by [react-dropzone](https://github.com/react-dropzone)
- [Lodash](https://lodash.com) by [lodash](https://github.com/lodash)

## License

Under [MIT License](LICENSE)
